const bodyString = [
  164811, 159906, 169416, 175927, 165315, 159483, 160519, 173781, 173369,
  164707, 175584, 142723, 142818, 167175, 148179, 143445, 153533, 136745,
  132389, 172802, 144650, 138324, 137474, 137541, 150878, 130050, 129072,
  135010, 167220, 134545, 127479, 134070, 140614, 131301, 141853, 121751,
  163869, 135370, 154556, 143272, 140997, 176226, 150198, 121755, 100432,
  118096, 110132, 125032, 140494, 109404, 108631, 147291, 106887, 172182,
  101815, 99022, 159963, 97599, 166252, 118085, 177599, 159930, 80621, 110224,
  144963, 144999, 165825, 93666, 108897, 99674, 81105, 132420, 88013, 88026,
  97005, 144689, 83048, 101140, 80242, 84414, 79565, 75895, 79530, 115123,
  115265, 148080, 91623, 54047, 100691, 75055, 72032, 128085, 68364, 120807,
  169039, 56764, 153932, 154593, 49811, 56863, 142964, 104744, 105086, 22999,
  112286, 132449, 22001, 39095, 52382, 150916, 148022, 46608, 176112, 147575,
  169063, 124861, 88857, 39493, 157844, 144708, 22125, 69896, 150007, 23342,
  25063, 126918, 96527, 33005, 23052, 134263, 158482, 22652, 22763, 23050,
  145349, 22732, 9299, 21030, 21843, 22538, 24959, 125125, 171239, 22292,
  116692, 163039, 20145, 21814, 21999, 54162, 9487, 99066, 8492, 20250, 21366,
  21546, 36913, 40974, 169067, 34658, 137668, 7895, 9276, 9402, 21330, 118441,
  176641, 155477, 76964, 22558, 8103, 20767, 8293, 9274, 9445, 20416, 21183,
  25513, 64044, 9304, 12931, 19966, 40971, 92113, 155473, 22651, 25460, 140549,
  20267, 134964, 73401, 6453, 9811, 26503, 8226, 9715, 79346, 87675, 9318,
  25676, 2300, 7190, 21489, 73730, 7637, 7689, 7888, 8174, 8538, 8713, 59313,
  73720, 114643, 130153, 136346, 163581, 5524, 6243, 7687, 8239, 148090, 5304,
  6834, 7703, 7858, 8458, 8461, 8465, 55350, 56911, 72023, 97019, 100269,
  132096, 134028, 54182, 6048, 164497, 2062, 9848, 5196, 177452, 5590, 6821,
  6844, 7828, 26513, 73716, 125843, 159878, 165204, 141308, 99072, 6270, 97560,
  7275, 118565, 140098, 7195, 5421, 2244, 2030, 2256, 2086, 2139, 7105, 7111,
  7133, 7677, 21455, 110177, 114285, 136572, 154598, 5200, 2228, 94374, 7142,
  21984, 43697, 170128, 22183, 95076, 170142, 3767, 6927, 22633, 23316, 55528,
  72402, 88842, 122111, 133205, 149925, 163093, 2002, 6692, 22665, 84575, 90801,
  90916, 138281, 23537, 95588, 2130, 23458, 6093, 6924, 6515, 6655, 130258,
  21787, 147763, 15429, 5191, 111203, 21470, 125909, 149248, 150526, 6462, 2145,
  6445, 80391, 134103, 6472, 6532, 6688, 6700, 6923, 9842, 23107, 23157, 26350,
  44936, 68488, 68512, 79789, 103674, 2050, 6493, 167570, 2324, 105815, 172681,
  87643, 6551, 6618, 23381, 99679, 153587, 6468, 42452, 85062, 2728, 130688,
  2340, 3629, 6952, 2008, 68459, 2166, 23541, 6926, 23074, 56848, 108793, 23574,
  20208, 77763, 68454, 171100, 26501, 5121, 2216, 9056, 33026, 132273, 132280,
  132289, 142674, 145477, 77770, 23470, 23542, 104761, 5650, 8858, 2317, 2345,
  73723, 92424, 101146, 128130, 135302, 2218, 23539, 80373, 2144, 2091, 2240,
  2174, 2651, 173316, 173771, 143391, 2337, 6559, 2046, 71980, 2266, 6556,
  147481, 3912, 3914, 53637, 68518, 22570, 2114, 153368, 83068, 2044, 20393,
  128412, 153697, 2088, 131224, 143100, 2200, 2299, 7768, 74139, 111217, 126582,
  22408, 33921, 171030, 2165, 2325, 3574, 95577, 164787, 2037, 2073, 40943,
  2083, 2247, 23414, 1994, 2290, 2239, 2155, 2480, 26517, 66314, 106939, 108868,
  112179, 121839, 171236, 2288, 134311, 2283, 2197, 71622, 100133, 2014, 117712,
  2205, 2119, 2309, 2107, 2241, 2039, 2051, 2326, 2291, 89971, 23467, 91823,
  134255, 171024, 2004, 2170, 2000, 2049, 34743, 117725, 170585, 130317, 2276,
  2018, 2131, 2195, 2246, 8789, 2219, 2011, 68491, 100672, 2188, 2642, 21786,
  91222, 2047, 2501, 52176, 2054, 2116, 2235, 2424, 23465, 33595, 121597,
  143281, 150203, 143480, 2984, 95556, 2313, 153183, 111446, 71902, 2151,
  150932, 2028, 2010, 2019, 2214, 2274, 2163, 2169, 64026, 102426, 116742,
  136803, 80613, 177448, 2126, 148757, 2141, 86883, 2189, 93271, 2077, 2129,
  2217, 2352, 121563, 136821, 145007, 174971, 97632, 1998, 2133, 2033, 2226,
  2045, 80926, 75748, 33570, 39912, 51260, 113759, 146015, 158545, 169020,
  170613, 95571, 22852, 91904, 23471, 71050, 2328, 2248, 23411, 2178, 96963,
  172478, 2277, 2222, 142851, 2346, 2098, 2017, 2220, 2210, 144750, 97628, 2135,
  2278, 2149, 2331, 72951, 119040, 22645, 2401, 20720, 1958, 26566, 1926, 1917,
  126615, 23185, 173811, 145512, 35421, 1481, 1467, 1344, 1473, 117983, 1323,
  160491, 1327, 1464, 1450, 23540, 91424, 1397, 1369, 25824, 149898, 165169,
  9821, 23001, 34732, 1368, 40172, 103445, 114159, 95600, 134904, 20216, 68806,
  1455, 132325, 21111, 174269, 1382, 177753, 1465, 53504, 1478, 176726, 91213,
  154588, 1314, 25024, 1320, 1375, 1463, 169439, 94168, 143243, 62708, 140191,
  1371, 1425, 124020, 136860, 167159, 88034, 1331, 1321, 79109, 26483, 62697,
  68800, 144734, 172767, 92616, 22044, 22136, 1364, 1387, 1418, 1312, 101394,
  117276, 1461, 1410, 1477, 1451, 68877, 68885, 9621, 1485, 88985, 77112, 68794,
  34671, 40634, 36613, 1343, 139918, 158650, 38457, 137612, 8788, 55734, 1390,
  94158, 1316, 1432, 118504, 68811, 138238, 25358, 1372, 1421, 1426, 1417, 1448,
  1483, 1445, 1374, 111672, 1308, 1385, 1398, 1486, 21113, 1391, 108872, 1322,
  125194, 87632, 1430, 148309, 171064, 166852, 158590, 62781, 62785, 62799,
  1334, 158318, 25677, 99666, 114313, 125770, 144870, 47003, 1454, 173559,
  28510, 1345, 1355, 7956, 65188, 135845, 1395, 1349, 1423, 1419, 1453, 57941,
  63202, 89015, 114314, 151112, 158637, 1403, 1389, 1474, 1411, 1446, 23180,
  23466, 95811, 158102, 158106, 168984, 5324, 5326, 5334, 1310, 1396, 22847,
  34679, 54824, 56305, 72018, 135261, 135720, 1429, 8508, 33603, 1413, 1379,
  90691, 95677, 21116, 21117, 68529, 108081, 170132, 5325, 5327, 5333, 168981,
  170629, 2281, 2013, 2025, 2103, 2318, 2060, 2053, 2075, 2009, 2257, 2227,
  2350, 1996, 177811, 169556, 2712, 2842, 3120, 3354, 169742, 3379, 3787, 3788,
  3789, 3791, 3798, 3807, 3818, 3822, 3823, 3828, 3830, 3832, 3834, 3836, 3838,
  3840, 3841, 3844, 3847, 3849, 3850, 4061, 4483, 4638, 5240, 5354, 5733, 6931,
  7258, 7261, 7715, 8737, 9197, 9407, 20222, 9179, 22448, 22667, 22740, 25596,
  28280, 34364, 47353, 47359, 53050, 145978, 94364, 95375, 96025, 97662, 97667,
  98745, 176486, 106363, 112758, 119256, 172285, 131957, 134474, 135276, 135290,
  135860, 136851, 136898, 136915, 142882, 154807, 154808, 159138, 166109,
  167406, 169013, 169032, 169411, 169455, 169593, 172507, 173019, 173552,
  175629, 175840, 176465, 176663, 177798, 177804,
];

const csv = require("csv-parser");
const { Readable } = require("stream");

async function getStandards() {
  const response = await fetch(
    "https://www.instituteforapprenticeships.org/apprenticeships/download",
    {
      method: "POST",
      body: JSON.stringify(bodyString),
      //   body: JSON.stringify([169411, 169455]),
      headers: {
        Accept: "application/json",
        "Accept-Encoding": "gzip, deflate, br, zstd",
        "Content-Type": "application/json",
      },
    }
  );

  const csvData = await response.text();
  const csvWithLines = csvData.split("\n");
  const csvFirstLineRemoved = csvWithLines.slice(1).join("\n");

  const standardsJSON = [];

  Readable.from(csvFirstLineRemoved)
    .pipe(csv())
    .on("data", (data) => {
      Object.keys(data).forEach((key) => {
        data[key] = data[key].replace(/\x00/g, "").trim(); // Clean up null bytes and spaces
      });
      if (Object.values(data).some((value) => value.length > 0)) {
        standardsJSON.push(data);
      }
    })
    .on("end", () => {
      console.log(standardsJSON);
    });
}
getStandards();
